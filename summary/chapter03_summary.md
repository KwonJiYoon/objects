## Chapter 03. 역할, 책임, 협력

### 협력

>**영화 예매 시스템 돌아보기**

![20240325085651.png](image%2F20240325085651.png)
* 어떤 하나의 객체에 의해 통제되지 않고 다양한 객체들 사시에 균형있게 분배
* 객체들은 요청을 따라 자신에게 분배된 로직을 실행하면서 전체적인 기능 완성
* 다양한 객체들이 _영화 예매_ 라는 기능을 구현하기 위해 메시지를 주고 받으며 상호작용 ❗️
    * `협력` : 객체들이 애플리케이션의 기능을 구현하기 위해 수행하는 상호작용
    * `책임` : 객체가 엽력에 참여하기 위해 수행하는 로직
    * `역할` : 객체들이 협력 안에서 수행하는 책임들이 모인 것
<br>
<br>
<br>

>**협력**

**협력이란 👀❓**   
- _어떤 객체가 다른 객체에게 무엇인가를 요청하는 것_
- 한 객체는 어떤 것이 필요할 때 다른 객체에게 전적으로 위임하거나 서로 협력   
  ➱ 두 객체가 상호작용을 통해 더 큰 책임 수행
- 객체는 고립된 존재가 아닌 시스템의 기능을 위해 다른 객체와 협력하는 사회적 존재
    - 협력은 이런 객체지향 세계에서 기능을 구현할 수 있는 유일한 방법
    - 한 객체가 다른 객체에게 도움을 요청할 때 협력 시작
- 객체 사이의 협력을 위해 사용할 수 있는 유일한 커뮤니케이션 수단 :: `메시지 전송 (message sending)`
    - 다른 객체의 내부에 직접 접근 할 수 없음 ❌ ➱ 메시지를 통하여 요청 전달
    - 메시지를 수신한 객체는 처리 방법을 직접 결정하여 메서드를 실행 후 응답   
      ➱ 자신의 일을 스스로 처리하는 자율적인 존재
      <br>
      <br>

Example 🔎 :: _Screening과 Movie의 협력_   

Screening 객체가 Movie에 calculateMovieFee 메시지를 전송하며 요금 계산을 요청   
➱ 기본 요금 & 할인 정책을 Movie 가 제일 잘 알고있기 때문.   

❓ _요금 계산을 Screening이 직접 수행한다면_ 🤔   
➱ Movie의 인스턴스 변수인 fee, discountPolicy에 직접 접근 :: Movie의 자율성 훼손 & _캡슐화 위반_   
➱ 정보와 행동이 Movie와 Screening으로 나뉘게 된다. :: Movie는 수동적 존재로 전락

∴ Movie가 자율적인 존재가 되려면 자신이 가지고있는 정보로 직접 요금 계산을 실행해야하기 때문에   
Screening이 Movie에게 요금 계산을 위임한 이유.   
<br>
<br>

>**협력이 설계를 위한 문맥을 결정한다**
   
애플리케이션 내에 어떤 객체가 필요한 이유는 협력에 참여하고 있기 때문.   
➱ 객체의 행동을 결정하는 것 :: 객체가 참여하고 있는 협력   
➱ 협력이 바뀌면 객체가 제공해야하는 행동도 변경   
➱ 협력은 객체가 필요한 이유, 수행하는 행동의 동기 제공   

❓ _Movie 객체는 어떤 행동을 수행할 수 있어야 할까?_ 🤔   
➱ 대부분의 메서드는 요금을 계산하는 행동과 관련   
➱ 영화를 예매하기 위한 협력에 참여하고 있고, Movie는 요금을 계산하는 책임을 갖고있기 때문   

```java
public class Movie {
  private Money fee;
  private DiscountPolicy discountPolicy;
  
  public Money calculateMovieFee(Screening screening) {
      return fee.minus(discountPolicy.calculateDiscountAmount(screening));
  }
}
```

* 객체의 상태를 결정하는 것 = 행동
* 객체는 자신의 상태를 스스로 결정하고 관리하는 자율적인 존재
  * 객체가 수행하는 행동에 필요한 상태도 함께 가지고 있어야함
* Movie가 fee, discountPolicy라는 인스턴스 변수를 상태의 일부로 포함
  * 요금 계산 수행 시 위 정보들 필요   
   
상태는 객체가 행동하는 데 필요한 정보에 의해 결정, 행동은 협력 안에서 객체가 처리할 메시지로 결정.   
➱ 객체가 참여하는 협력이 객체를 구성하는 행동, 상태 모두 결정   

∴  협력은 객체를 설계하는 데 필요한 `문맥(context)` 제공
<br>
<br>
---   

### 책임

>**책임이란 무엇인가**

**책임이란 👀❓**   
* _협력에 참여하기 위해 객체가 수행하는 행동_
* 객체가 유지해야 하는 정보, 수행할 수 있는 행동에 대해 서술한 문장
* `하는 것 (doing)`
    * 객체를 생성하거나 계산을 수행하는 등 스스로 하는 것
    * 다른 객체의 행동을 시작 시키는 것
    * 다른 객체의 활동을 제어하고 조절하는 것
* `아는 것 (knowing)`
    * 사적인 정보에 관해 아는 것
    * 관련된 객체에 관해 아는 것
    * 자신이 유도하거나 계산할 수 있는 것에 관해 아는 것   
  


Example 🔎
```java
public class Screenning {
    private Movie movie; // 상영할 영화  
    
    ...
    
    public Reservation reserve(Customer customer, int audienceCount){
        return Reservation(customer, this, calculateFee(audienceCount), audienceCount);
    }
    
}
```

 ```java
public class Movie {
    private Money fee;
    private DiscountPolicy discountPolicy;
    
    ...
    
    public Money calculateMovieFee(Screening screening) {
        return fee.minus(discountPolicy.calculateDiscountAmount(screening));
    }
```
협력 안에서 객체에게 할당한 책임이 외부의 인터페이스와 내부의 속성을 결정한다.   

* `아는 것`과 `하는 것`의 연관
    * 자신이 맡은 책임을 수행하는 데 필요한 정보를 알고 있을 책임
    * 자신이 할 수 없는 작업을 도와줄 객체를 알고 있을 책임
    * 어떤 책임을 수행하기 위해 필요한 정보도 함께 알아야 할 책임
  
_적절한 협력이 적절한 책임을 제공하고, 적절한 책임을 적절한 객체에 할당해야 단순,유연한 설계 창조_   
<br>

>**책임 할당**   

`INFORMATION EXPERT(정보 전문가) 패턴`   
➱ 책임을 수행하는 데 필요한 정보를 가장 잘 알고있는 전문가에게 책임을 할당하는 것   
➱ 객체를 자율적인 존재로 만드는 가장 기본적인 방법   

**Example**  🔎 :: _영화 예매 시스템_

Step01 .   
![20240326115016.png](image%2F20240326115016.png)   
시스템의 책임 ➱ 영화를 예매하는 것   
_예매하라_ 는 메시지로 협력 시작 !   
<br>
Step02.   
![20240326170403.png](image%2F20240326170403.png)   
메시지를 선택했으면 이 메시지를 처리할 적절한 객체를 선택해야한다.   
➱ 영화를 예매하기 위해서 상영 시간과 기본 요금이 필요한데, 이 정보를 소유하고 있거나,   
소유자를 잘 아는 **_Screenig_** 에게 할당   
<br>
Step03.   
![20240326170711.png](image%2F20240326170711.png)   
영화 예매를 하려면 가격이 필요한데, Screening은 가격 계산 하기에는 정보가 충분하지 않다.   
➱ 다른 객체에게 도움을 요청해야 한다는 의미 :: 새로운 메시지 _가격을 계산하라_   
<br>
Step04.   
![20240326170711.png](image%2F20240326170711.png)   
가격 계산을 위해 필요한 것은, 기본 가격과 할인 정책   
➱ 위 정보를 잘 알고있는 **_Movie_** 에게 할당   
<br>
🤔❓   
하지만 할인 요금을 계산하기에는 Movie는 적절한 객체가 아니다.   
➱ 다른 객체에게 도움을 요청해야 하는 상황 :: 새로운 메시지 필요 _할인 요금을 계산하라_   
<br>
이처럼 객체지향 설계는 협력에 필요한 메시지를 찾고, 적절한 객체에게 할당하는 반복적인 과정이다.  



